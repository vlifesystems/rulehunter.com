<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>Experiments</title>
  <meta name="description" content="How to describe an experiment">
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/prism.css" rel="stylesheet" />
  <link rel="canonical" href="http://rulehunter.com/docs/experiments">
  <link rel="alternate" type="application/rss+xml" title="Rulehunter - Find simple rules in your data to meet your goals"
        href="http://rulehunter.com/feed.xml" />
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/prism.js"></script>

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

  <body>
    <nav class="navbar">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Rulehunter</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/docs/">Docs</a></li>
        <li><a href="/news/">News</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</nav>

    <div class="container">
      <div class="row">
  <div class="col-md-10 col-md-offset-2">
    <div class="hero">
      <h1>Experiments</h1>
      <h2>An experiment describes what you want Rulehunter to do</h2>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-2">
  <ol class="doc-breadcrumb breadcrumb">
      <li class="active">Docs</li>
  </ol>
    <nav class="navbar">
      <ul class="nav">
          <li>
            <a href="/docs" title="A quick outline of Rulehunter">
              Overview
            </a>
          </li>
          <li>
            <a href="/docs/installation" title="How to install Rulehunter">
              Installation
            </a>
          </li>
          <li>
            <a href="/docs/configuration" title="How to configure Rulehunter">
              Configuration
            </a>
          </li>
          <li>
            <a href="/docs/experiments" title="How to describe an experiment">
              Experiments
            </a>
          </li>
          <li>
            <a href="/docs/usage" title="How to run Rulehunter">
              Usage
            </a>
          </li>
          <li>
            <a href="/docs/contributing" title="How to contribute to Rulehunter">
              Contributing
            </a>
          </li>
          <li>
            <a href="/docs/licence" title="Rulehunter is open source">
              Licence
            </a>
          </li>
          <li>
            <a href="/docs/examples" title="Examples to show how Rulehunter can be used">
              Examples
            </a>
          </li>
      </ul>
    </nav>
  </div>
  <div class="col-md-10">
    <h2>An Experiment file</h2>
<p>An <em>experiment</em> is what describes the dataset that you want to process and what you want the generated rules to aim for.  Each experiment is described by a <code>.yaml</code> or a <code>.json</code> file located in the <code>experimentsDir</code> of <code>config.yaml</code>.  This will look as follows:</p>
<pre><code class="language-yaml"># The title of the report
title: &quot;What would indicate good flow?&quot;

# The category that this report is in
category: &quot;acme&quot;

# The tags associated with the report
tags:
  - test
  - &quot;household sewage&quot;

train:
  # The dataset to used to train the rule discovery process
  dataset:
    # Describe a CSV dataset
    csv:
      # The name of the CSV file
      filename: &quot;fixtures/flow.csv&quot;
      # Whether the CSV file contains a header line
      hasHeader: true
      # What separator the CSV file is using
      separator:  &quot;,&quot;
    # The names of the fields to be used
    fields:
      - group
      - district
      - height
      - flow
    # Describe rule generation
    ruleGeneration:
      # The fields that can be used in the rules
      fields:
        - group
        - district
        - height
      # Whether arithmetic rules should be generated
      arithmetic: true
      # The maximum number of rules that can be combined together to form
      # another rule
      combinationLength: 3
  # When to run the experiment's train mode (default: !hasRun)
  when: &quot;!hasRunToday || sinceLastRunHours &gt; 2&quot;


test:
  # An optional dataset used to test the rules generated from the train dataset
  dataset:
    # Describe an SQL connection
    sql:
      # The name of the driver to use (mssql, mysql, postgres, sqlite3)
      driverName: &quot;mssql&quot;
      # The details of the data source
      dataSourceName: &quot;Server=127.0.0.1;Port=1433;Database=master;UID=sa,PWD=letmein&quot;
      # An SQL query to run on the data source to create the dataset
      query: &quot;select * from flow&quot;
    # The names of the fields to be used
    fields:
      - group
      - district
      - height
      - flow
  # When to run the experiment's test mode (default: !hasRun)
  when: &quot;!hasRunToday || sinceLastRunMinutes &gt; 20&quot;

# Describe aggregators
aggregators:
    # The name of the aggregator
  - name: &quot;goodFlowMCC&quot;
    # The kind of aggregator to use
    # (calc, count, mcc, mean, precision, recall, sum)
    kind: &quot;mcc&quot;
    # The argument to pass to the aggregator function
    arg:  &quot;flow &gt; 60&quot;

# What goals to try to achieve
goals:
  - &quot;goodFlowMCC &gt; 0&quot;

# The order to sort the rules in
sortOrder:
  - aggregator: &quot;goodFlowMCC&quot;
    direction:  &quot;descending&quot;
  - aggregator: &quot;numMatches&quot;
    direction:  &quot;descending&quot;

# User defined rules to try
rules:
  - &quot;height &gt; 10&quot;
  - &quot;height &gt; 10 &amp;&amp; height &lt; 20&quot;
</code></pre>
<h2>SQL</h2>
<p>For more information about <code>dataSourceName</code> see the following for each <code>driverName</code>:</p>
<ul>
<li><code>mssql</code> - MS SQL Server - <a href="https://github.com/denisenkom/go-mssqldb/blob/master/README.md">README</a>.</li>
<li><code>mysql</code> - MySQL - <a href="https://github.com/go-sql-driver/mysql#dsn-data-source-name">README</a>.</li>
<li><code>postgres</code> - PostgreSQL - <a href="https://godoc.org/github.com/lib/pq#hdr-Connection_String_Parameters">GoDoc</a>.</li>
<li><code>sqlite3</code> - sqlite3 - This just uses the filename of the database.</li>
</ul>
<p><em>For security reasons any user specified for an SQL source should only have read access to the tables/database as the queries can't be checked for safety.</em></p>
<h2>Aggregators</h2>
<p>The aggregators are used to collect data on the records that match against a rule.  There are the following functions:</p>
<br />
<table class="table table-bordered">
  <tr><th>Function</th><th>Description</th></tr>
  <tr>
    <td><code>calc(expr)</code</td>
    <td>Calculate the result of expression using as variables any aggregatorNames used in the expressiona</td>
  </tr>
  <tr>
    <td><code>count(expr)</code></td>
    <td>Count the number of records that match a rule and the supplied expression</td>
  </tr>
  <tr>
    <td><code>mcc(expr)</code></td>
    <td>Calculate the <a href="https://en.wikipedia.org/wiki/Matthews_correlation_coefficient">Matthews correlation coefficient</a> of a rule to match against the expression passed.  A coefficient of +1 represents a perfect prediction, 0 no better than random prediction and âˆ’1 indicates total disagreement between prediction and observation.</td>
  </tr>
  <tr>
    <td><code>mean(expr)</code></td>
    <td>Calculate the mean value for an expression calculated on records that match a rule</td>
  </tr>
  <tr>
    <td><code>precision(expr)</code></td>
    <td>Calculate the <a href="https://en.wikipedia.org/wiki/Precision_and_recall">precision</a> of a rule to match against the expression passed</td>
  </tr>
  <tr>
    <td><code>recall(expr)</code></td>
    <td>Calculate the <a href="https://en.wikipedia.org/wiki/Precision_and_recall">recall</a> of a rule to match against the expression passed</td>
  </tr>
  <tr>
    <td><code>sum(expr)</code></td>
    <td>calculates the sum for an expression calculated on records that match a rule</td>
  </tr>
</table>
<h2>Sort Order</h2>
<p>The rules in the report are sorted in the order of the entries for the <code>sortOrder</code> field.  The aggregators that can be used are the names specified in the <code>aggregators</code> field as well as the following built-in aggregators.</p>
<br />
<table class="table table-bordered">
  <tr><th>Aggregator</th><th>Description</th></tr>
  <tr>
    <td><code>numMatches</code></td>
    <td>The number of records that a rule matches against</td>
  </tr>
  <tr>
    <td><code>percentMatches</code></td>
    <td>The percent of records in the dataset that a rule matches against</td>
  </tr>
  <tr>
    <td><code>goalsScore</code></td>
    <td>How well a rule passes the goals.  The higher the number the better the match</td>
  </tr>
</table>
<h2>When Expressions</h2>
<p>The <code>when</code> field determines when the experiment is to be run and how often.  It is an expression that supports the following variables:</p>
<br />
<table class="table table-bordered">
  <tr><th>Variable</th><th>Description</th></tr>
  <tr>
    <td><code>hasRun</code></td>
    <td>Whether the experiment has been ever been run</td>
  </tr>
  <tr>
    <td><code>hasRunToday</code></td>
    <td>Whether the experiment has been run today</td>
  </tr>
  <tr>
    <td><code>hasRunThisWeek</code></td>
    <td>Whether the experiment has been run this week</td>
  </tr>
  <tr>
    <td><code>hasRunThisMonth</code></td>
    <td>Whether the experiment has been run this month</td>
  </tr>
  <tr>
    <td><code>hasRunThisYear</code></td>
    <td>Whether the experiment has been run this year</td>
  </tr>
  <tr>
    <td><code>sinceLastRunMinutes</code></td>
    <td>The number of minutes since the experiment was last run</td>
  </tr>
  <tr>
    <td><code>sinceLastRunHours</code></td>
    <td>The number of hours since the experiment was last run</td>
  </tr>
  <tr>
    <td><code>isWeekday</code></td>
    <td>Whether today is a weekday</td>
  </tr>
</table>
<h2>Expressions</h2>
<p>Any expressions used in the experiment file conform to fairly standard Go expressions and can use the following functions:</p>
<table class="table table-bordered">
  <tr><th>Function</th><th>Description</th></tr>
  <tr>
    <td><code>if(b, t, f)</code></td>
    <td>Return <code>t</code> if <code>b</code> is true, otherwise returns <code>f</code></td>
  </tr>
  <tr>
    <td><code>iferr(v, av)</code></td>
    <td>Return <code>v</code> if not an error, otherwise return <code>av</code></td>
  </tr>
  <tr>
    <td><code>in(n, h ...)</code></td>
    <td>Return whether <code>n</code> is in the rest of the arguments</td>
  </tr>
  <tr>
    <td><code>ni(n, h ...)</code></td>
    <td>Return whether <code>n</code> is not in the rest of the arguments</td>
  </tr>
  <tr>
    <td><code>max(n ...)</code></td>
    <td>Return the biggest number supplied</td>
  </tr>
  <tr>
    <td><code>min(n ...)</code></td>
    <td>Return the smallest number supplied</td>
  </tr>
  <tr>
    <td><code>pow(b, e)</code></td>
    <td>Raise <code>b</codeL to power of <code>e</code></td>
  </tr>
  <tr>
    <td><code>roundto(n, p)</code></td>
    <td>Round <code>n</code> to <code>p</code> decimal places</td>
  </tr>
  <tr>
    <td><code>sqrt(x)</code></td>
    <td>Return the square root of <code>x</code></td>
  </tr>
</table>
  </div>
</div>

    </div><!-- /.container -->

    <div class="container-fluid">
  <footer>
    <nav class="navbar navbar-default">
      <ul class="nav navbar-nav navbar-right">
        <li><a class="navbar-brand" href="/">Rulehunter</a></li>
        <li><a href="http://vlifesystems.com">Company</a></li>
        <li><a href="/news/">News</a></li>
        <li><a href="/docs/">Docs</a></li>
      </ul>
      <p class="pull-left">
        The content of this site is licensed under <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.
     </p>
    </nav>
  </footer>
</div>

  </body>
</html>
